# OmnisFlow - Etický Rámec a Implementační Manuál

## 1. Etické Scénáře pro Simulátor Sentinelu

### Scénář A: EEG Koncentrace & Externí Přístup k Datům
**Situace:** Aplikace sbírá EEG pro metriky soustředění a ukládá jen agregované skóre do OmnisVault; partner požaduje přístup k syrovým datům na validaci modelu.

**Vyhodnocení:**
- **Riziko:** Vysoké - syrová EEG data mohou odhalit mentální stavy nad rámec koncentrace
- **Doporučení:** Zamítnout přístup k syrovým datům. Nabídnout diferenčně soukromé agregáty
- **Podmínky:** Zero-knowledge důkazy pro validaci bez odhalení dat

### Scénář B: DNA Synchronizace & Monetizace
**Situace:** DNA synchronizace 'High' spouští personalizaci doporučení; provozovatel chce tyto profily monetizovat přes anonymní segmenty.

**Vyhodnocení:**
- **Riziko:** Střední - re-identifikace přes behaviorální vzorce
- **Doporučení:** K-anonymita (k≥50), časově omezené segmenty (24h)
- **Podmínky:** Transparentní opt-out, diferenciální soukromí ε≤0.1

### Scénář C: Consent-to-Earn & Dočasné Úložiště
**Situace:** Consent-to-Earn vyplácí tokeny za autentickou pozitivní mimiku; aby se snížily podvody, zvažuje se krátkodobé uchování videa.

**Vyhodnocení:**
- **Riziko:** Vysoké - biometrická data obličeje, emotional fingerprinting
- **Doporučení:** Lokální inference pouze, žádné video storage
- **Podmínky:** Edge computing, liveness detection, 0-knowledge proofs

## 2. Consent-to-Earn Komponenta (Čistší Implementace)

### Frontend Sekvence
```javascript
// ConsentToEarnFlow.tsx
export default function ConsentToEarnFlow() {
  const [consentLevel, setConsentLevel] = useState('none')
  const [isProcessing, setIsProcessing] = useState(false)
  
  const handleVideoConsent = async (level: 'basic' | 'enhanced' | 'research') => {
    setConsentLevel(level)
    
    // Granulární consent s časovými omezeními
    const consentConfig = {
      basic: { duration: '1h', dataTypes: ['facial_landmarks'], reward: 1 },
      enhanced: { duration: '24h', dataTypes: ['emotion_basic'], reward: 5 },
      research: { duration: '7d', dataTypes: ['emotion_full'], reward: 25 }
    }
    
    await startLocalInference(consentConfig[level])
  }
  
  const startLocalInference = async (config) => {
    setIsProcessing(true)
    
    // Lokální zpracování - žádné nahrávání
    const stream = await navigator.mediaDevices.getUserMedia({ video: true })
    const analyzer = new LocalEmotionAnalyzer()
    
    // Real-time analýza bez persistentního storage
    const result = await analyzer.processStream(stream, {
      maxDuration: config.duration,
      dataTypes: config.dataTypes,
      onComplete: (metrics) => submitMetrics(metrics, config.reward)
    })
    
    setIsProcessing(false)
  }
  
  const submitMetrics = async (metrics, reward) => {
    // Zero-knowledge proof o validních metrikách
    const zkProof = await generatePositivityProof(metrics)
    
    await fetch('/api/positivity', {
      method: 'POST',
      body: JSON.stringify({ 
        proof: zkProof, 
        reward: reward,
        timestamp: Date.now() 
      })
    })
  }
}
```

### Backend API Endpoint
```python
# /api/positivity endpoint
from cryptography.fernet import Fernet
from datetime import datetime, timedelta

async def validate_positivity_proof(request):
    proof = request.json()['proof']
    
    # Validace ZK proof bez přístupu k syrovým datům
    if not verify_zk_proof(proof):
        return {"error": "Invalid proof", "reward": 0}
    
    # Rate limiting - max 3 claims za hodinu
    user_claims = get_user_claims(request.user_id, hours=1)
    if len(user_claims) >= 3:
        return {"error": "Rate limit exceeded", "reward": 0}
    
    # Mint OmnisToken reward
    reward_amount = proof.get('reward', 1)
    await mint_omnistoken(request.user_id, reward_amount)
    
    return {"success": True, "reward": reward_amount}
```

## 3. OmnisVault - Bezpečnostní Zásady

### Architektura Úložiště
```yaml
OmnisVault:
  encryption:
    algorithm: "AES-256-GCM"
    key_derivation: "Argon2id"
    key_rotation: "monthly"
    
  storage_tiers:
    tier_1_critical:  # EEG raw, DNA profiles
      retention: "30 days"
      access: "user + 2FA only"
      backup: "encrypted, air-gapped"
      
    tier_2_metrics:   # Aggregated scores
      retention: "1 year"
      access: "user + applications"
      backup: "encrypted, versioned"
      
    tier_3_insights:  # Derived analytics
      retention: "indefinite"
      access: "user controlled"
      backup: "standard encrypted"

  access_controls:
    rbac:
      roles: ["owner", "viewer", "researcher", "emergency"]
      permissions: ["read", "write", "delete", "share", "audit"]
    
    authentication:
      primary: "biometric + PIN"
      fallback: "recovery_phrase + hardware_key"
      session: "24h max, idle 15min"
```

### Privacy by Design Implementace
```python
# vault_manager.py
class OmnisVaultManager:
    def __init__(self, user_id):
        self.user_id = user_id
        self.encryption_key = self._derive_user_key()
        
    def store_eeg_data(self, eeg_raw, consent_level):
        """Ukládání EEG s automatickou minimizací dat"""
        
        # Data minimization - pouze potřebné komponenty
        if consent_level == 'focus_only':
            processed_data = extract_attention_metrics(eeg_raw)
        elif consent_level == 'wellness':
            processed_data = extract_wellness_indicators(eeg_raw)
        
        # Differential privacy pro agregace
        if self._requires_aggregation(consent_level):
            processed_data = add_differential_privacy(
                processed_data, epsilon=0.1
            )
        
        # Template storage - ne raw biometrika
        encrypted_template = self._create_template(processed_data)
        
        # Automatické mazání podle consent časového limitu
        expiry = datetime.now() + self._get_retention_period(consent_level)
        
        return self._store_encrypted(encrypted_template, expiry)
    
    def _create_template(self, data):
        """Ireversibilní template - nejde rekonstruovat original"""
        template = BiometricTemplate()
        template.extract_features(data)
        return template.get_revocable_template()  # Lze zrušit a obnovit
```

## 4. UI Panely - Texty a Stavy

### EEG Panel Texty
```javascript
const EEG_STATES = {
  connecting: {
    title: "Připojování EEG",
    subtitle: "Navazujem spojení s headsetem...",
    icon: "connecting"
  },
  calibrating: {
    title: "Kalibrace",
    subtitle: "Uzavři oči na 30 sekund pro baseline",
    icon: "calibrating"  
  },
  active: {
    title: "Soustředění: {level}%",
    subtitle: "Real-time stream aktivní • {duration}",
    icon: "wave"
  },
  paused: {
    title: "Pozastaveno",
    subtitle: "Klikni pro obnovení měření",
    icon: "paused"
  }
}
```

### DNA Sync Stavy
```javascript
const DNA_SYNC_STATES = {
  'off': {
    status: "Vypnuto",
    description: "DNA personalizace není aktivní",
    color: "#666"
  },
  'low': {
    status: "Nízká",
    description: "Základní genetické preference",
    color: "#FFA500"
  },
  'high': {
    status: "Vysoká", 
    description: "Plná personalizace aktivní",
    color: "#00FF88"
  },
  'syncing': {
    status: "Synchronizace...",
    description: "Aktualizuji genetický profil", 
    color: "#00BFFF"
  }
}
```

### Sentinel Network Status
```javascript
const SENTINEL_STATUS = {
  offline: {
    count: "0 / 800",
    status: "Síť offline",
    action: "Spustit mesh protokol",
    color: "#FF4444"
  },
  connecting: {
    count: "12 / 800", 
    status: "Připojování k síti",
    action: "Hledám sentinely...",
    color: "#FFA500"
  },
  active: {
    count: "187 / 800",
    status: "Aktivní monitoring",
    action: "Ethical governance online",
    color: "#00FF88"
  },
  degraded: {
    count: "45 / 800",
    status: "Omezený dosah", 
    action: "Posilovat mesh spojení",
    color: "#FFAA00"
  }
}
```

### Notification Messages
```javascript
const NOTIFICATIONS = {
  consent_required: {
    title: "Vyžadován souhlas",
    message: "Nová aplikace požaduje přístup k EEG metrikám",
    actions: ["Povolit", "Zamítnout", "Upravit"]
  },
  
  vault_backup: {
    title: "Záloha dokončena",
    message: "OmnisVault bezpečně zálohován (šifr: AES-256)",
    actions: ["Zobrazit", "Export"]
  },
  
  sentinel_alert: {
    title: "Etická výstraha",
    message: "Sentinel detekoval neautorizovaný přístup k neural data",
    actions: ["Prošetřit", "Blokovat", "Ignorovat"]
  },
  
  token_earned: {
    title: "+25 OmnisToken",
    message: "Odměna za poskytnutí consent-to-earn dat",
    actions: ["Zobrazit bilanci", "Nakonfigurovat"]
  }
}
```

## 5. Implementační Pokyny

### Prioritní Kroky
1. **Týden 1-2:** Implementovat lokální EEG zpracování bez cloud storage
2. **Týden 3-4:** Nasadit zero-knowledge proof systém pro consent-to-earn
3. **Týden 5-6:** Vytvořit OmnisVault s template-only storage
4. **Týden 7-8:** Otestovat celý flow s reálnými uživateli

### Bezpečnostní Checklist
- [ ] Žádná raw biometrika v cloudu
- [ ] Differential privacy pro všechny agregace (ε ≤ 0.1)  
- [ ] K-anonymita minimálně k=50 pro segmentaci
- [ ] Template storage s revocable funkcionalitou
- [ ] End-to-end encryption pro všechnu komunikaci
- [ ] Regular security audits (měsíčně)
- [ ] Incident response plán pro data breaches

### Compliance Požadavky
- **GDPR:** Right to be forgotten, data minimization, consent granularity
- **BIPA:** Informed consent pro biometrika, secure storage, deletion timelines  
- **Neurorights:** Mental privacy protection, cognitive liberty preservation
- **ISO 24745:** Biometric template protection standards

Tento rámec zajišťuje, že OmnisFlow funguje eticky, transparentně a v souladu s nejpřísnějšími standardy ochrany soukromí.